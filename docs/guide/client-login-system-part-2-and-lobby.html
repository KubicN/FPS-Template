<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Client Login System part 2 and Lobby | EmbeddedFPSExample</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/EmbeddedFPSExample/assets/css/0.styles.4f978004.css" as="style"><link rel="preload" href="/EmbeddedFPSExample/assets/js/app.bd6dbef1.js" as="script"><link rel="preload" href="/EmbeddedFPSExample/assets/js/6.ebb66877.js" as="script"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/10.bfc4e5c9.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/11.2dfd0f84.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/12.f08e0c48.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/13.d3bab40f.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/14.8aa13ea9.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/15.b9bc1680.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/16.e621ed86.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/17.4425fd00.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/2.9916d692.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/3.228d207b.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/4.83497b66.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/5.407c6f53.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/7.b2f24b07.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/8.1eaf922b.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/9.aac61ed3.js">
    <link rel="stylesheet" href="/EmbeddedFPSExample/assets/css/0.styles.4f978004.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/EmbeddedFPSExample/" class="home-link router-link-active"><!----> <span class="site-name">EmbeddedFPSExample</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/EmbeddedFPSExample/guide/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/EmbeddedFPSExample/guide/setting-up-the-projects.html" class="sidebar-link">Setting up the projects</a></li><li><a href="/EmbeddedFPSExample/guide/client-basics-and-login-system-part-1.html" class="sidebar-link">Client Basics and Login System part 1</a></li><li><a href="/EmbeddedFPSExample/guide/server-basics-and-login-system.html" class="sidebar-link">Server Basics and Login System</a></li><li><a href="/EmbeddedFPSExample/guide/room-system-part-1-server-side.html" class="sidebar-link">Room System part 1 (Server-side)</a></li><li><a href="/EmbeddedFPSExample/guide/client-login-system-part-2-and-lobby.html" class="active sidebar-link">Client Login System part 2 and Lobby</a></li><li><a href="/EmbeddedFPSExample/guide/room-system-part-2-server-side.html" class="sidebar-link">Room System part 2 (Server-side)</a></li><li><a href="/EmbeddedFPSExample/guide/player-movement-interpolation-and-client-side-prediction.html" class="sidebar-link">Player-Movement, Interpolation and Client Side Prediction</a></li><li><a href="/EmbeddedFPSExample/guide/multiplayer-gameplay.html" class="sidebar-link">Multiplayer Gameplay (Synchronization,-Buffers)</a></li><li><a href="/EmbeddedFPSExample/guide/reconciliation.html" class="sidebar-link">Reconciliation</a></li><li><a href="/EmbeddedFPSExample/guide/health-shooting-lag-Compensation.html" class="sidebar-link">Health, Shooting, Lag Compensation</a></li><li><a href="/EmbeddedFPSExample/guide/networking-discussion.html" class="sidebar-link">Networking Discussion</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="client-login-system-part-2-and-lobby"><a href="#client-login-system-part-2-and-lobby" aria-hidden="true" class="header-anchor">#</a> Client Login System part 2 and Lobby</h1> <p>After creating responses to the LoginRequest on the server we can let the client handle them.
To do that we first have to subscribe to server messages in the LoginManager script.
Add the following in the Start() function:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    GlobalManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>MessageReceived <span class="token operator">+</span><span class="token operator">=</span> OnMessage<span class="token punctuation">;</span>
</code></pre></div><p>and the function:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">void</span> <span class="token function">OnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        GlobalManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>MessageReceived <span class="token operator">-</span><span class="token operator">=</span> OnMessage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>(We always have to unsubscribe from events)</p> <p>Also add the OnMessage function and functions to handle the responses:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">OnMessage</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">MessageReceivedEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">Message</span> m <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Tags<span class="token punctuation">)</span> m<span class="token punctuation">.</span>Tag<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">case</span> Tags<span class="token punctuation">.</span>LoginRequestDenied<span class="token punctuation">:</span>
                    <span class="token function">OnLoginDecline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> Tags<span class="token punctuation">.</span>LoginRequestAccepted<span class="token punctuation">:</span>
                    <span class="token function">OnLoginAccept</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token punctuation">&lt;</span><span class="token class-name">LoginInfoData</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnLoginDecline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        LoginWindow<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnLoginAccept</span><span class="token punctuation">(</span><span class="token class-name">LoginInfoData</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>The OnMessage function works like the one we did on the server.</p> <p>OnLoginDecline will just show the login window again. (You could a line of text saying login failed or something like that)</p> <p>OnLoginAccept will store the data and load a LobbyScene to do that we first have to create fields in the GlobalManager to store data. (We will store all data that has to be preserved on scene changes in the GlobalManager).</p> <p>So Add to the GlobalManager:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token punctuation">[</span><span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token string">&quot;Public Fields&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">ushort</span> PlayerId<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">LobbyInfoData</span> LastRecievedLobbyInfoData<span class="token punctuation">;</span>
</code></pre></div><p>and then modify the OnLoginAccept() function in the LoginManager to:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnLoginAccept</span><span class="token punctuation">(</span><span class="token class-name">LoginInfoData</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        GlobalManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>PlayerId <span class="token operator">=</span> data<span class="token punctuation">.</span>Id<span class="token punctuation">;</span>
        GlobalManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>LastRecievedLobbyInfoData <span class="token operator">=</span> data<span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
        SceneManager<span class="token punctuation">.</span><span class="token function">LoadScene</span><span class="token punctuation">(</span><span class="token string">&quot;Lobby&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Now let's create the client side lobby.</p> <ul><li>Create a new Scene &quot;Lobby&quot; in the Scenes folder and open it.</li> <li>Create a LobbyManager GameObject.</li> <li>Create a &quot;LobbyManager&quot; script in the Scripts folder and add it to the LobbyManager GameObject.</li></ul> <p>We want to display a list of all rooms in graphical matter, we will use UI elements for that:</p> <ul><li>Create a Canvas &gt; set it to &quot;Scale with Screen Size&quot; and Reference Resolution to 1920x1080</li> <li>Create a Scroll View as a child of the Canvas.</li> <li>Add a Vertical Layout Group to the Content object of the Scroll view</li></ul> <p>Now we need to create RoomObjects. First create a RoomObject script in the Scripts folder and open it and fill it with the following code:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> UnityEngine<span class="token punctuation">;</span>
<span class="token keyword">using</span> UnityEngine<span class="token punctuation">.</span>UI<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoomListObject</span> <span class="token punctuation">:</span> <span class="token class-name">MonoBehaviour</span>
<span class="token punctuation">{</span>

    <span class="token punctuation">[</span><span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token string">&quot;References&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token class-name">Text</span> NameText<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Text</span> SlotText<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Button</span> JoinButton<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token class-name">RoomData</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        NameText<span class="token punctuation">.</span>text <span class="token operator">=</span> data<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
        SlotText<span class="token punctuation">.</span>text <span class="token operator">=</span> data<span class="token punctuation">.</span>Slots <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>MaxSlots<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Should be self explanatory. The Set() function is used to apply a RoomData to it.
We will also have to create a prefab for the script:</p> <ul><li>Create a UI Image as a child of the Content of Scroll View and name it RoomListPrefab.</li> <li>Add 2 texts and a button to it, 1 text will be the name the other the slots and the button will be used to join the room.</li> <li>Add the RoomListObject script to it and refrecne the texts and the button.</li></ul> <p>It should look now kind of like <a href="https://imgur.com/gallery/6ElYM5g" target="_blank" rel="noopener noreferrer">this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:<br> <img src="https://i.imgur.com/2xuzOVj.png" alt></p> <p>Now drag the RoomListPrefab into the prefabs folder and then delete it from the scene.</p> <p>Open the LobbyManager script and set it to:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> DarkRift<span class="token punctuation">;</span>
<span class="token keyword">using</span> DarkRift<span class="token punctuation">.</span>Client<span class="token punctuation">;</span>
<span class="token keyword">using</span> UnityEngine<span class="token punctuation">;</span>
<span class="token keyword">using</span> UnityEngine<span class="token punctuation">.</span>SceneManagement<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LobbyManager</span> <span class="token punctuation">:</span> <span class="token class-name">MonoBehaviour</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LobbyManager</span> Instance<span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token string">&quot;References&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token class-name">Transform</span> RoomListContainerTransform<span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token string">&quot;Prefabs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token class-name">GameObject</span> RoomListPrefab<span class="token punctuation">;</span>


    <span class="token keyword">void</span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        GlobalManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>MessageReceived <span class="token operator">+</span><span class="token operator">=</span> OnMessage<span class="token punctuation">;</span>
        <span class="token function">RefreshRooms</span><span class="token punctuation">(</span>GlobalManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>LastRecievedLobbyInfoData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">void</span> <span class="token function">OnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        GlobalManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>MessageReceived <span class="token operator">-</span><span class="token operator">=</span> OnMessage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">OnMessage</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">MessageReceivedEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">Message</span> m <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Tags<span class="token punctuation">)</span>m<span class="token punctuation">.</span>Tag<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
              
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

   
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">RefreshRooms</span><span class="token punctuation">(</span><span class="token class-name">LobbyInfoData</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        RoomListObject<span class="token punctuation">[</span><span class="token punctuation">]</span> roomObjects <span class="token operator">=</span> RoomListContainerTransform<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentsInChildren</span><span class="token punctuation">&lt;</span><span class="token class-name">RoomListObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>Rooms<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">RoomData</span> d <span class="token operator">=</span> data<span class="token punctuation">.</span>Rooms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> roomObjects<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                roomObjects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">GameObject</span> go <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>RoomListPrefab<span class="token punctuation">,</span> RoomListContainerTransform<span class="token punctuation">)</span><span class="token punctuation">;</span>
                go<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token punctuation">&lt;</span><span class="token class-name">RoomListObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><p>This might look overwhelming at first glance but its very simple.
The script has a reference to a RoomListContainerTransform which is the transform of the Content and a reference to the RoomListPrefab. (you should go drag them into their respective fields).
It also subscribes like the LoginManager to the server to recieve messages.</p> <p>The last thing it does is the RefreshRooms() function. I'm not going to explain that function but it does refresh the display of all the rooms, it shouldn't be too complicated to understand.</p> <p>At this point you can try to run the project. Run the server first and then the client and check it you can log in and if it displays 2 rooms &quot;Main&quot; and &quot;Main 2&quot; in the lobby.</p> <p>If everyting works fine you can continue. If not, try to look if any errors occurred somewhere. If you are totally stuck you can always contact me on Discord (@Allmaron#6641) or ask in the <a href="https://discordapp.com/invite/cz2FQ6k" target="_blank" rel="noopener noreferrer">Offical Darkrift Discord<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>The next step is to allow the player to join a Room. We will need to create new request messages for that.
First add the following new Tags in the NetworkingData.Tags enum:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    LobbyJoinRoomRequest <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
    LobbyJoinRoomDenied <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">,</span>
    LobbyJoinRoomAccepted <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">,</span>
</code></pre></div><p>We also need a new data object for the request so also add:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">struct</span> JoinRoomRequest <span class="token punctuation">:</span> IDarkRiftSerializable
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> RoomName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">JoinRoomRequest</span><span class="token punctuation">(</span><span class="token keyword">string</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        RoomName <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Deserialize</span><span class="token punctuation">(</span><span class="token class-name">DeserializeEvent</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        RoomName <span class="token operator">=</span> e<span class="token punctuation">.</span>Reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token class-name">SerializeEvent</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>RoomName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And then open the LobbyManager and add these functions:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">SendJoinRoomRequest</span><span class="token punctuation">(</span><span class="token keyword">string</span> roomName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">Message</span> m <span class="token operator">=</span> Message<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">ushort</span><span class="token punctuation">)</span>Tags<span class="token punctuation">.</span>LobbyJoinRoomRequest<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JoinRoomRequest</span><span class="token punctuation">(</span>roomName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            GlobalManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>Client<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> SendMode<span class="token punctuation">.</span>Reliable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnRoomJoinDenied</span><span class="token punctuation">(</span><span class="token class-name">LobbyInfoData</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RefreshRooms</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnRoomJoinAcepted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        SceneManager<span class="token punctuation">.</span><span class="token function">LoadScene</span><span class="token punctuation">(</span><span class="token string">&quot;Game&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>And change the OnMessage function to:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">OnMessage</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">MessageReceivedEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">Message</span> m <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Tags<span class="token punctuation">)</span>m<span class="token punctuation">.</span>Tag<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">case</span> Tags<span class="token punctuation">.</span>LobbyJoinRoomDenied<span class="token punctuation">:</span>
                    <span class="token function">OnRoomJoinDenied</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token punctuation">&lt;</span><span class="token class-name">LobbyInfoData</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> Tags<span class="token punctuation">.</span>LobbyJoinRoomAccepted<span class="token punctuation">:</span>
                    <span class="token function">OnRoomJoinAcepted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Ok so what does this do?
We have a function SendJoinRoomRequest to ask the server to join a room with a given Name.
The server can respond with an Accepted or a Denied resposne. The Denied request will contain new RoomDatas so that the rooms and available slots get refreshed and the accepted will just load the &quot;Game&quot; scene because it means we connected successfully.</p> <p>Now we just need a way to call SendJoinRoomRequest(). We will subscribe the function to the buttons in the list of rooms.
To do that open the RoomListObject script and at the end of the Set function the following lines:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>JoinButton<span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">RemoveAllListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
JoinButton<span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span><span class="token keyword">delegate</span> <span class="token punctuation">{</span> LobbyManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">SendJoinRoomRequest</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Your scripts should look like this:</p> <ul><li><a href="https://pastebin.com/ue7T0sFL" target="_blank" rel="noopener noreferrer">LoginManager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://pastebin.com/wMBubKxN" target="_blank" rel="noopener noreferrer">GlobalManager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://pastebin.com/2Fvczdq1" target="_blank" rel="noopener noreferrer">RoomListObject<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://pastebin.com/MZpWAuqX" target="_blank" rel="noopener noreferrer">LobbyManager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://pastebin.com/HYXKwysi" target="_blank" rel="noopener noreferrer">Networking Data<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>The lobby and login system is now fully completed on the client. Now, we will swap now to the server to finish the system there too.</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/EmbeddedFPSExample/guide/room-system-part-1-server-side.html" class="prev">
          Room System part 1 (Server-side)
        </a></span> <span class="next"><a href="/EmbeddedFPSExample/guide/room-system-part-2-server-side.html">
          Room System part 2 (Server-side)
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/EmbeddedFPSExample/assets/js/6.ebb66877.js" defer></script><script src="/EmbeddedFPSExample/assets/js/app.bd6dbef1.js" defer></script>
  </body>
</html>
