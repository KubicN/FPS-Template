(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{172:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"health-shooting-lag-compensation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#health-shooting-lag-compensation","aria-hidden":"true"}},[t._v("#")]),t._v(" Health, Shooting, Lag Compensation")]),t._v(" "),s("p",[t._v("Before we start to implement health and shooting we will add a simple health bar to our player to display it.\nOpen the ClientPlayer script and add the following variables to the References:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Text")]),t._v(" NameText"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Image")]),t._v(" HealthBarFill"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("GameObject")]),t._v(" HealthBarObject"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("and add the follwing to the Public Fields:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" Health"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Then add these functions:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("SetHealth")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("value")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        Health "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("value")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        HealthBarFill"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fillAmount "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("value")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("100f")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("LateUpdate")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{attrs:{class:"token class-name"}},[t._v("Vector3")]),t._v(" point "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Camera"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("main"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("WorldToScreenPoint")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Vector3")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("point"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z "),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("2")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            HealthBarObject"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" point"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            HealthBarObject"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Vector3")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token number"}},[t._v("10000")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("And in the Initialize function after Name = name; add:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v(" NameText"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Name"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{attrs:{class:"token function"}},[t._v("SetHealth")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token number"}},[t._v("100")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Open the Game scene and drag the player prefab into it.")]),t._v(" "),s("ul",[s("li",[t._v("Right click on the player(in the Hierarchy) and choose UI - canvas. This creates a new gameobject with a UI canvas attached as a child of the player.")]),t._v(" "),s("li",[t._v('Set the canvas scaler to scale with screen size and set the reference resolution to 1920x1080 and name the gameobject "HealthBar"')]),t._v(" "),s("li",[t._v('Right click the HealthBar and choose Create Empty. This creates an empty gameobject. Rename it to "Root".')]),t._v(" "),s("li",[t._v("Set the Rect Transform Pos Y property of the Root to 50.")]),t._v(" "),s("li",[t._v('Right click the Root and choose UI - image to create a new child with an image attached. Name it "Border". Set the Source Image of the Image component to UISprite, Image Type to simple and in the Rect Transform set the height to 20.')]),t._v(" "),s("li",[t._v("Right click the Border and choose UI - image again. name it \"Fill\". set it's source image to UISprite and set the Image Type to filled and Fill Method to Horizontal and Fill Origin to Left. Finally also set it's height to 20 in the Rect Transform.")]),t._v(" "),s("li",[t._v('Right click the Root and choose UI/Text to add a child object with a text attached to it. Name it "TextObject".')]),t._v(" "),s("li",[t._v("In the Rect Transform of the TextObject set Pos Y to 22 and in the Text component set the Font Size to 18 and Font Style to bold.")]),t._v(" "),s("li",[t._v("Go to the Player and set the NameText variable to the TextObject, Health Bar Fill to the Fill and HealthBarObject to the Root.")])]),t._v(" "),s("p",[t._v("Now we have a working health bar that hovers over our player and displays the current health state. It should look like this now:"),s("br"),t._v(" "),s("img",{attrs:{src:"https://imgur.com/a/ZhfjZwW",alt:""}}),t._v("\nMake sure to apply the changes to the Player prefab and then delete it from the scene.")]),t._v(" "),s("p",[t._v("Before we start with the actual shooting let's create something to display our shots.")]),t._v(" "),s("ul",[s("li",[t._v('Create a new GameObject in the Game scene name it "Shot"')]),t._v(" "),s("li",[t._v("Add a line renderer to the object")]),t._v(" "),s("li",[t._v("Set the material to default-line")]),t._v(" "),s("li",[t._v("And the positions to 2 positions the first being (0,0,0) and the second (0,0,100)")]),t._v(" "),s("li",[t._v("Set the color to red and the alpha to something like 120")]),t._v(" "),s("li",[t._v("Set the width to 0.2"),s("br"),t._v(" "),s("img",{attrs:{src:"https://i.imgur.com/YQsYGC9.png",alt:""}})])]),t._v(" "),s("p",[t._v("Drag it in the prefab folders then delete it from the Scene.")]),t._v(" "),s("p",[t._v("Open the ClientPlayer and add:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token class-name"}},[t._v("Header")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"Prefabs"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("GameObject")]),t._v(" ShotPrefab"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("and in FixedUpdate before:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    yaw "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("GetAxis")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"Mouse X"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" SensitivityX"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("add:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("            "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inputs"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token number"}},[t._v("5")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{attrs:{class:"token class-name"}},[t._v("GameObject")]),t._v(" go "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("Instantiate")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ShotPrefab"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                go"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Interpolation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CurrentData"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Position"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                go"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rotation "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rotation"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{attrs:{class:"token function"}},[t._v("Destroy")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("go"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token number"}},[t._v("1f")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Finally we will need a way to change player health over the network so open Networking Data and add:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" PLayerHealthUpdateData "),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IDarkRiftSerializable\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("ushort")]),t._v(" PlayerId"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("byte")]),t._v(" Value"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("PLayerHealthUpdateData")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("ushort")]),t._v(" id"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("byte")]),t._v(" val"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        PlayerId "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" id"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        Value "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" val"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("Deserialize")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token class-name"}},[t._v("DeserializeEvent")]),t._v(" e"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        PlayerId "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Reader"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("ReadUInt16")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        Value "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Reader"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("ReadByte")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("Serialize")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token class-name"}},[t._v("SerializeEvent")]),t._v(" e"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        e"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Writer"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Write")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("PlayerId"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        e"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Writer"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Write")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Value"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("And change the GameUpdateData a bit. Add the following below the other arrays:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" PLayerHealthUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" HealthData"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Also pass a HealthUpdateDataArray into the constructor. It should look like this now:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("GameUpdateData")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("uint")]),t._v(" frame"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PlayerUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" updateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PlayerSpawnData"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" spawns"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PlayerDespawnData"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" despawns"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PLayerHealthUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" healthDatas"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        Frame "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" frame"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        UpdateData "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" updateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        DespawnData "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" despawns"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        SpawnData "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" spawns"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        HealthData "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" healthDatas"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("In the serialize function at the end, add this:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    e"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Writer"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Write")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HealthData"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Same for the deserialize method")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("        HealthData "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Reader"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token generic-method"}},[s("span",{attrs:{class:"token function"}},[t._v("ReadSerializables")]),s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{attrs:{class:"token class-name"}},[t._v("PLayerHealthUpdateData")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Finally open the GameManager and in the PerformGameUpdate function add the following below the last foreach loop:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("   "),s("span",{attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token class-name"}},[t._v("PLayerHealthUpdateData")]),t._v(" data "),s("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" updateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HealthData"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{attrs:{class:"token class-name"}},[t._v("ClientPlayer")]),t._v(" p"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("players"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("TryGetValue")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PlayerId"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("out")]),t._v(" p"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                p"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("SetHealth")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Switch to the server project and open the Room script and add:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" List"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("PLayerHealthUpdateData"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" HealthUpdates "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token generic-method"}},[s("span",{attrs:{class:"token function"}},[t._v("List")]),s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{attrs:{class:"token class-name"}},[t._v("PLayerHealthUpdateData")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("And in the FixedUpdate change the lines that send the message to:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" m "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Message"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Create")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("ushort")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Tags"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GameUpdate"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("GameUpdateData")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("InputTick"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" UpdateDatas"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tpsd"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tpdd"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HealthUpdates"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("ToArray")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                p"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Client"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("SendMessage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SendMode"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Reliable"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("and at the end of FixedUpdate call:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("        HealthUpdates"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Clear")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Now open the ServerPlayer and add to the Public Fields:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" Health"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("and initialize add after InputTick = Room.ServerTick:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("        Health "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("100")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("also add a function to let a player take damage and respawn him if he dies:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("  "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("TakeDamage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("value")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        Health "),s("span",{attrs:{class:"token operator"}},[t._v("-")]),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("value")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Health "),s("span",{attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Health "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("100")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            CurrentUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Position "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Vector3")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token number"}},[t._v("1")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localPosition"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            CurrentUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Gravity "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localPosition "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" CurrentUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Position"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        Room"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HealthUpdates"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Add")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("PLayerHealthUpdateData")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Client"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Health"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Now lets do lag compensation 😀")]),t._v(" "),s("p",[t._v("To do lag compensation we will need a historyBuffer on the server too so open the ServerPlayer and add:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" List"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("PlayerUpdateData"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" UpdateDataHistory "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token generic-method"}},[s("span",{attrs:{class:"token function"}},[t._v("List")]),s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{attrs:{class:"token class-name"}},[t._v("PlayerUpdateData")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("and at the end of the PerformUpdate function add:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("        UpdateDataHistory"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Add")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CurrentUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UpdateDataHistory"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count "),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("10")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            UpdateDataHistory"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("RemoveAt")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("We want the shots to be performed in a separate loop before the main game update because then all players are in the same frame. But this means we have to store inputs somehow so in the ServerPlayer add:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" PlayerInputData"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" inputs"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("And remove the following line from PerformUpdate:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("        PlayerInputData"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" inputs "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" inputBuffer"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Now add a new function for inputs and shooting:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("  "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("PerformuPreUpdate")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        inputs "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" inputBuffer"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" inputs"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Length"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{attrs:{class:"token operator"}},[t._v("++")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inputs"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Keyinputs"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token number"}},[t._v("5")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                Room"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("PerformShootRayCast")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inputs"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("We will go implement the missing PerformShootRayCast in the Room:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("      "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("PerformShootRayCast")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("uint")]),t._v(" frame"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("ServerPlayer")]),t._v(" shooter"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" dif "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ServerTick "),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" frame"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{attrs:{class:"token comment"}},[t._v("//get the position of the ray")]),t._v("\n        "),s("span",{attrs:{class:"token class-name"}},[t._v("Vector3")]),t._v(" firepoint"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token class-name"}},[t._v("Vector3")]),t._v(" direction"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shooter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UpdateDataHistory"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count "),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" dif"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            firepoint "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" shooter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UpdateDataHistory"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dif"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Position"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            direction "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" shooter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UpdateDataHistory"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dif"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LookDirection "),s("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" Vector3"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("forward"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            firepoint "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" shooter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CurrentUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Position"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            direction "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" shooter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CurrentUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LookDirection "),s("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" Vector3"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("forward"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        firepoint "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" direction "),s("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("3f")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{attrs:{class:"token comment"}},[t._v("//set all players back in time")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token class-name"}},[t._v("ServerPlayer")]),t._v(" player "),s("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ServerPlayers"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("player"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UpdateDataHistory"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count "),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" dif"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                player"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logic"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CharacterController"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enabled "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                player"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localPosition "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" player"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UpdateDataHistory"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dif"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Position"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\n        "),s("span",{attrs:{class:"token class-name"}},[t._v("RaycastHit")]),t._v(" hit"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("physicsScene"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("Raycast")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("firepoint"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" direction"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token keyword"}},[t._v("out")]),t._v(" hit"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("200f")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("CompareTag")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"Unit"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                hit"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token generic-method"}},[s("span",{attrs:{class:"token function"}},[t._v("GetComponent")]),s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{attrs:{class:"token class-name"}},[t._v("ServerPlayer")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("TakeDamage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token number"}},[t._v("5")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n        "),s("span",{attrs:{class:"token comment"}},[t._v("//set all players back")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token class-name"}},[t._v("ServerPlayer")]),t._v(" player "),s("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ServerPlayers"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            player"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localPosition "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" player"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CurrentUpdateData"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Position"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            player"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logic"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CharacterController"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enabled "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v('This looks complicated at first glance but it isn\'t. First we calculate for how many frames we have to lag compensate( the -1 because we ticked up already in this tick). Then we set all players back to that point of time by using the history buffers, next we create a ray and check if he hit a "Unit" and if we do we deal damage to that player. Finally we set all players back. Note that we use physicsScene.Raycast(). We do so because our room has its own physicsScene and using just Physics.Raycast() would cast that ray on the default scene.')]),t._v(" "),s("p",[t._v('The only thing left to do now is to create the "Unit" tag and add it to the player prefab and also to add a capsule collider to the player prefab.')]),t._v(" "),s("p",[t._v("Now we can run around on a map with collisions and shoot other players and even join multiple rooms, this should be the basic functions of an FPS. There is still much room to extend to for instance:")]),t._v(" "),s("ul",[s("li",[t._v("Let players create rooms")]),t._v(" "),s("li",[t._v("Ammo")]),t._v(" "),s("li",[t._v("Abilties and cooldowns")]),t._v(" "),s("li",[t._v("A death zone if players fall out of the map")]),t._v(" "),s("li",[t._v("Well... a better map")])]),t._v(" "),s("p",[t._v("But I'll leave that to you!")])])}],!1,null,null,null);e.options.__file="health-shooting-lag-Compensation.md";a.default=e.exports}}]);